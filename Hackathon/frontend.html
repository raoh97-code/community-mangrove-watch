<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Community Mangrove Watch</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --green-600: #15803d;
      --green-400: #4ade80;
      --blue-500: #0ea5e9;
      --bg: #f6fffb;
      --card: #ffffff;
      --muted: #6b7280;
      --glass: rgba(255, 255, 255, 0.7);
      --shadow: 0 6px 18px rgba(13, 50, 0, 0.08);
      --radius: 14px;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, #f0fff6, #e6f7ff 60%);
      color: #063a2b;
    }

    .wrap {
      max-width: 1100px;
      margin: 20px auto;
      padding: 16px;
    }

    header {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: var(--glass);
      border-radius: 12px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(6px);
    }

    .brand {
      display: flex;
      gap: 12px;
      align-items: center
    }

    .logo {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      background: linear-gradient(135deg, var(--green-600), var(--blue-500));
      box-shadow: 0 4px 10px rgba(14, 165, 233, 0.16);
    }

    h1 {
      font-size: 18px;
      margin: 0
    }

    .tag {
      font-size: 12px;
      color: var(--muted)
    }

    nav {
      display: flex;
      gap: 8px;
      flex-wrap: wrap
    }

    nav button {
      background: transparent;
      border: none;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      color: #044734;
      font-weight: 600
    }

    nav button:hover {
      background: rgba(5, 70, 40, 0.06)
    }

    /* hero */
    .hero {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 18px
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow)
    }

    .hero-left h2 {
      margin: 0 0 8px 0;
      font-size: 22px
    }

    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap
    }

    .btn {
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 600
    }

    .btn-report {
      background: linear-gradient(90deg, var(--green-600), var(--green-400));
      color: white
    }

    .btn-donate {
      background: linear-gradient(90deg, var(--blue-500), #38bdf8);
      color: white
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(5, 70, 40, 0.08)
    }

    .highlights {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 12px
    }

    .small {
      font-size: 13px;
      color: var(--muted)
    }

    /* layout */
    .main-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
      margin-top: 16px
    }

    /* responsive */
    @media (max-width:880px) {
      .main-grid {
        grid-template-columns: 1fr
      }

      .highlights {
        grid-template-columns: 1fr
      }

      header {
        flex-direction: column;
        align-items: flex-start
      }

      nav {
        width: 100%;
        justify-content: space-between
      }
    }

    /* forms & inputs */
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      color: #0b3b2b
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #e6f0ea;
      background: #fbfff9;
      font-size: 14px
    }

    textarea {
      resize: vertical
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px
    }

    @media(max-width:600px) {
      .form-row {
        grid-template-columns: 1fr
      }
    }

    .status-pill {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: #f0fff6;
      color: #056a2c;
      font-weight: 700;
      border: 1px solid rgba(5, 106, 44, 0.06)
    }

    .complaint-card {
      display: flex;
      gap: 12px;
      align-items: flex-start
    }

    .complaint-meta {
      font-size: 13px;
      color: var(--muted)
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px
    }

    @media(max-width:600px) {
      .gallery-grid {
        grid-template-columns: repeat(2, 1fr)
      }
    }

    .small-card {
      background: #f7fff8;
      border-radius: 10px;
      padding: 8px;
      border: 1px solid rgba(5, 70, 40, 0.04)
    }

    .link-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px
    }

    .leader-row {
      display: flex;
      justify-content: space-between;
      padding: 8px;
      border-radius: 10px;
      background: white;
      border: 1px solid #eef7f0
    }

    footer {
      margin-top: 20px;
      text-align: center;
      color: var(--muted);
      font-size: 13px
    }

    .muted {
      color: var(--muted)
    }

    /* micro animations */
    .btn,
    button[type="submit"] {
      transition: transform .12s ease, box-shadow .12s ease
    }

    .btn:active,
    button[type="submit"]:active {
      transform: translateY(1px)
    }

    .hidden {
      display: none
    }

    .topbar-actions {
      display: flex;
      gap: 8px;
      align-items: center
    }

    .pill {
      background: rgba(0, 0, 0, 0.04);
      padding: 6px 10px;
      border-radius: 999px
    }

    .card h3 {
      margin-top: 0
    }
  </style>
</head>

<body>
  <div class="wrap" aria-live="polite">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">CM</div>
        <div>
          <h1>Community Mangrove Watch</h1>
          <div class="tag">Protect Our Mangroves, Protect Our Future</div>
        </div>
      </div>

      <div class="topbar-actions">
        <nav role="navigation" aria-label="Main navigation">
          <button data-view="home">Home</button>
          <button data-view="complaints">Complaints</button>
          <button data-view="track">Track</button>
          <button data-view="learn">Learn</button>
          <button data-view="ngos">NGOs</button>
          <button data-view="donate">Donate</button>
          <button data-view="links">Links</button>
          <button data-view="contact">Contact</button>
        </nav>
        <div id="auth-area" style="margin-left:8px">
          <button id="btn-login" class="pill">Login</button>
        </div>
      </div>
    </header>

    <!-- HOME -->
    <main id="home" class="hero" role="main">
      <div class="card hero-left">
        <h2>Protect Our Mangroves, Protect Our Future</h2>
        <p class="small">A community platform to report threats, track actions and join restoration work.</p>

        <div class="actions" style="margin-top:12px">
          <button class="btn btn-report" onclick="showSection('complaints','file')">Report Complaint</button>
          <button class="btn btn-donate" onclick="showSection('donate')">Donate</button>
          <button class="btn btn-ghost" onclick="showSection('ngos')">Volunteer</button>
          <button class="btn btn-ghost" onclick="showSection('learn')">Learn</button>
        </div>

        <div class="highlights">
          <div class="small-card">
            <h3>Recent Complaints</h3>
            <div id="home-complaints" class="small muted">No complaints yet.</div>
          </div>
          <div class="small-card">
            <h3>Success Stories</h3>
            <div class="small muted">Community clean-up restored mangrove saplings in zone A.</div>
          </div>
          <div class="small-card">
            <h3>Upcoming Events</h3>
            <div class="small muted">Sep 10 — Beach clean-up • 07:00 AM</div>
          </div>
        </div>
      </div>

      <aside class="card" aria-labelledby="sidebar-title">
        <h3 id="sidebar-title">Quick Actions</h3>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <button class="btn btn-report" onclick="showSection('complaints','file')">Report</button>
          <button class="btn btn-donate" onclick="showSection('donate')">Donate</button>
          <button class="btn btn-ghost" onclick="showSection('ngos')">Join NGO</button>
        </div>

        <div style="margin-top:14px">
          <h4 class="small">Top Volunteers</h4>
          <div id="leaderboard" style="margin-top:8px"></div>
        </div>
      </aside>
    </main>

    <!-- MAIN GRID: left = content, right = sidebar -->
    <div class="main-grid" style="margin-top:18px">

      <!-- Left column holds dynamic section content -->
      <div id="content-area">

        <!-- COMPLAINTS / FILE -->
        <section id="complaints" class="card hidden" aria-labelledby="comp-title">
          <h2 id="comp-title">Report a Complaint</h2>
          <form id="complaint-form">
            <div style="display:flex;gap:8px;align-items:center">
              <label style="flex:1">
                Category
                <select id="c-category" required>
                  <option>Illegal Cutting</option>
                  <option>Land Reclamation</option>
                  <option>Pollution</option>
                  <option>Dumping</option>
                </select>
              </label>
              <label style="flex:2">
                Short description
                <input id="c-desc" type="text" placeholder="What happened? (brief)" required />
              </label>
            </div>

            <div class="form-row" style="margin-top:10px">
              <label>
                Photo / Video (optional)
                <input id="c-media" type="file" accept="image/*,video/*" />
              </label>
              <label>
                Location (auto)
                <input id="c-loc" type="text" placeholder="Latitude, Longitude (will fill automatically)" readonly />
              </label>
            </div>

            <div style="display:flex;gap:8px;margin-top:12px">
              <button class="btn btn-report" type="submit">Submit Complaint</button>
              <button type="button" class="btn btn-ghost" onclick="captureLocation()">Capture Location</button>
              <div id="complaint-msg" class="muted" style="align-self:center"></div>
            </div>
          </form>
        </section>

        <!-- TRACK -->
        <section id="track" class="card hidden" aria-labelledby="track-title">
          <h2 id="track-title">Track Your Complaint</h2>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="track-id" type="text" placeholder="Enter Complaint ID (e.g. CM-20250830-AB12)" style="flex:1" />
            <button class="btn btn-donate" onclick="searchComplaint()">Search</button>
          </div>
          <div id="track-result" style="margin-top:12px"></div>
        </section>

        <!-- LEARNING -->
        <section id="learn" class="card hidden" aria-labelledby="learn-title">
          <h2 id="learn-title">Learning Corner</h2>
          <div style="display:flex;gap:12px;flex-wrap:wrap">
            <div style="flex:1;min-width:240px">
              <h4>FAQs</h4>
              <ul>
                <!-- <li><strong>What are mangroves?</strong> Coastal trees and shrubs adapted to saline water.</li>
                <li><strong>How to help?</strong> Report incidents, volunteer, avoid dumping.</li> -->
                 <!-- <a href="C:\Users\priyanka.159\Documents\FAQ Guide.pptx" target="_blank">guide line for web and info</a>-->
                <object data="C:\Users\priyanka.159\Documents\FAQ Guide.pptx" type="application/pdf" width="100%" height="600px">
  <p>PDF cannot be displayed. <a href="C:\Users\priyanka.159\Documents\FAQ Guide.pptx">Download PDF</a></p>
</object>
<!--<embed src="C:\Users\priyanka.159\Documents\FAQ Guide.pptx" type="blank" width="100%" height="600px" />-->
                
                 
              </ul>
            </div>
            <div style="flex:1;min-width:240px">
              <h4>Awareness</h4>
              <ol>
               <li><a href="https://www.downtoearth.org.in/environment/world-mangrove-day-mangrove-conservation-in-india-is-an-impressive-turnaround-story-but-challenges-remain">World Mangrove Day: Their conservation in India is an impressive turnaround story but challenges remain</a></li> 
               <li><a href="https://www.wwfindia.org/?20442/Godrej--Boyce-and-WWF-India-aims-to-empower-over-100-mangrove-ambassadors-in-nine-coastal-states-of-India">Godrej & Boyce and WWF India, aims to empower over 100 mangrove ambassadors in nine coastal states of India</a></li> 
               <li><a href="https://www.bing.com/videos/riverview/relatedvideo?&q=mangrove+preservation+awareness&&mid=6207E804B097EFBDF8226207E804B097EFBDF822&&FORM=VRDGAR">Restoring and protecting Mangrove trees for Marine Biodiversity </a></li>
              </ol>
            </div>
            <div style="flex-basis:100%; margin-top:8px">
              <h4>Media Gallery</h4>
              <image src="https://www.aiib.org/en/news-events/media-center/blog/2023/_img/_big/AIIB-Blog-Mangroves-Conservation-in-Indonesia_banner-photo_1129x620px.jpg?download=true" height="120px"></image>
              <image src="https://planeta.com/pl-content/uploads/2017/07/mangroveday-1024x768.jpg" height="120px"></image>
              <image src="https://www.sciencenews.org/wp-content/uploads/2020/06/060420_CG_mangroves_feat-1028x579.jpg" height="120px"></image>
              <div id="gallery" class="gallery-grid" style="margin-top:8px"></div>
            </div>
          </div>
        </section>

        <!-- NGOs -->
        <section id="ngos" class="card hidden" aria-labelledby="ngos-title">
          <h2 id="ngos-title">NGOs & Volunteers</h2>

          <div style="display:flex;gap:12px;flex-wrap:wrap">
            <div style="flex:1;min-width:260px">
              <h4>Register / Login (NGO or Volunteer)</h4>
              <form id="auth-form">
                <input id="auth-name" type="text" placeholder="Full name" required />
                <input id="auth-email" type="email" placeholder="Email" required />
                <input id="auth-phone" type="tel" placeholder="Phone" />
                <input id="auth-pass" type="password" placeholder="Password (min 6)" required />
                <div style="display:flex;gap:8px;margin-top:8px">
                  <button class="btn btn-report" type="submit">Register</button>
                  <button type="button" class="btn btn-ghost" id="btn-auth-login">Login</button>
                </div>
                <div id="auth-msg" class="muted" style="margin-top:8px"></div>
              </form>
            </div>

            <div style="flex:1;min-width:260px">
              
              <div id="ngolist" style="display:grid;gap:8px;margin-top:8px"></div>
            </div>

            <div style="flex-basis:100%; margin-top:8px">
              <h4>NGO Dashboard (only visible when NGO logged in)</h4>
              <div id="ngo-dashboard" class="small muted">Not logged in as NGO.</div>
            </div>
          </div>
        </section>

        <!-- DONATE -->
        <section id="donate" class="card hidden" aria-labelledby="donate-title">
          <h2 id="donate-title">Support the Cause</h2>
          <p class="small">Choose amount and method — (demo: no real payment integration)</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
            <button class="btn" onclick="setDonate(100)">₹100</button>
            <button class="btn" onclick="setDonate(500)">₹500</button>
            <button class="btn" onclick="setDonate(1000)">₹1000</button>
            <input id="don-custom" type="text" placeholder="Custom amount (₹)"
              style="width:140px;padding:8px;border-radius:8px;border:1px solid #e6f0ea" />
            <button class="btn btn-donate" onclick="doDonate()">Donate</button>
          </div>

          <div style="margin-top:14px" class="card small-card">
            <h4>Where your donation goes</h4>
            <ul>
              <li>On-ground clean-ups & restoration</li>
              <li>Community workshops</li>
              <li>Equipment & safety for volunteers</li>
            </ul>
          </div>
        </section>

        <!-- LINKS -->
        <section id="links" class="card hidden" aria-labelledby="links-title">
          <h2 id="links-title">Useful Links</h2>
          <div class="link-grid" style="margin-top:8px">
            <a href="https://www.bing.com/ck/a?!&&p=1519a757d5eafd27a61e53153555bc9dacba01b72bfa31089f0e79d2c7116d19JmltdHM9MTc1NjUxMjAwMA&ptn=3&ver=2&hsh=4&fclid=001789f2-b54b-664a-13bc-9c3bb4d06731&psq=government+coastal+protection&u=a1aHR0cHM6Ly9pcnJpZ2F0aW9uLmtlcmFsYS5nb3YuaW4vc2l0ZXMvZGVmYXVsdC9maWxlcy8yMDIxLTA2L0NXQ19HdWlkZWxpbmVzX0NvYXN0YWwucGRm&ntb=1"
              class="small-card">Govt Coastal Protection Portal</a>
            <a href="https://www.bing.com/ck/a?!&&p=3e42ca24421e49d98b7f11b59900ccb7ccfe7bafcf722ed8bd8ee22159fe4f24JmltdHM9MTc1NjUxMjAwMA&ptn=3&ver=2&hsh=4&fclid=001789f2-b54b-664a-13bc-9c3bb4d06731&psq=government+coastal+protection+act&u=a1aHR0cHM6Ly9sYXdiaG9vbWkuY29tL21hcmluZS1hbmQtY29hc3RhbC1jb25zZXJ2YXRpb24taW4taW5kaWEv&ntb=1" class="small-card">Environmental Laws & Rules</a>
            <a href="https://www.bing.com/ck/a?!&&p=d102450b6a6f1818ed17bfcdfeeaec07250a615801b0eb64dc5cacf55d85db4aJmltdHM9MTc1NjUxMjAwMA&ptn=3&ver=2&hsh=4&fclid=001789f2-b54b-664a-13bc-9c3bb4d06731&psq=hoe+to+report+any+illegal+crime&u=a1aHR0cHM6Ly9jc2ljLm9yZy5pbi9ob3ctdG8tcmVwb3J0LWEtY2FzZS8&ntb=1" class="small-card">How to Report - Guide</a>
            <a href="https://www.bing.com/ck/a?!&&p=01fa33d18ba54057818284a388d86c7cf8fce7c7ec711a1c3158ff223fafd1ceJmltdHM9MTc1NjUxMjAwMA&ptn=3&ver=2&hsh=4&fclid=001789f2-b54b-664a-13bc-9c3bb4d06731&psq=mangrove+volunteer&u=a1aHR0cHM6Ly93d3cudm9sdW50ZWVyd29ybGQuY29tL2VuL3ZvbHVudGVlci1hYnJvYWQvbWFuZ3JvdmUtY29uc2VydmF0aW9u&ntb=1" class="small-card">Volunteer Resources</a>
          </div>
        </section>

        <!-- CONTACT -->
        <section id="contact" class="card hidden" aria-labelledby="contact-title">
          <h2 id="contact-title">Contact Us</h2>
          <form id="contact-form">
            <div class="form-row">
              <input id="ct-name" type="text" placeholder="Your name" required />
              <input id="ct-email" type="email" placeholder="Your email" required />
            </div>
            <label>
              Message
              <textarea id="ct-msg" rows="4" placeholder="How can we help?" required></textarea>
            </label>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="btn btn-donate" type="submit">Send Message</button>
              <div class="muted">Phone: +91-XXXXXXXXXX • WhatsApp: +91-XXXXXXXXXX</div>
            </div>
            <div id="contact-res" class="muted" style="margin-top:8px"></div>
          </form>
        </section>

      </div>

      <!-- Right column / sidebar summary -->
      <aside>
        <div class="card">
          <h3>How to Report</h3>
          <ol class="small">
            <li>Take clear photo(s)</li>
            <li>Turn on location & capture</li>
            <li>Submit, note the complaint ID</li>
          </ol>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Complaint status legend</h3>
          <div style="display:flex;gap:8px;margin-top:8px">
            <div class="status-pill">Accepted</div>
            <div class="status-pill" style="background:#fff3cd;color:#7a5a00">In Action</div>
            <div class="status-pill" style="background:#e6fff0;color:#066a2c">Completed</div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Contact & Social</h3>
          <div class="small muted">Email: connect@communitymangrove.org</div>
          <div style="margin-top:8px;display:flex;gap:8px;margin-top:12px">
            <a class="pill" href="#" aria-label="Instagram">IG</a>
            <a class="pill" href="#" aria-label="X/Twitter">X</a>
            <a class="pill" href="#" aria-label="Facebook">FB</a>
          </div>
        </div>
      </aside>
    </div>

    <footer>
      © <span id="year"></span> Community Mangrove Watch — Built with ❤️ for the coast
    </footer>

  </div>

  <script>
    /* ---------- Simple client-side data store using localStorage ---------- */
    const store = {
      get(key) { try { return JSON.parse(localStorage.getItem(key) || 'null') } catch (e) { return null } },
      set(key, val) { localStorage.setItem(key, JSON.stringify(val)) },
      push(key, item) { const arr = store.get(key) || []; arr.unshift(item); store.set(key, arr) }
    };

    /* ---------- Helpers ---------- */
    function uid(len = 4) { return Math.random().toString(16).slice(2, 2 + len).toUpperCase(); }
    function complaintId() { const d = new Date(); const y = d.getFullYear(); const m = String(d.getMonth() + 1).padStart(2, '0'); const day = String(d.getDate()).padStart(2, '0'); return `CM-${y}${m}${day}-${uid(4)}` }

    /* ---------- Routing / view control ---------- */
    const views = ['home', 'complaints', 'track', 'learn', 'ngos', 'donate', 'links', 'contact'];
    function showSection(view, sub = null) {
      views.forEach(v => {
        const el = document.getElementById(v); if (el) el.classList.toggle('hidden', v !== view);
      });
      // open file view if requested
      if (view === 'complaints' && sub === 'file') document.getElementById('complaints').scrollIntoView({ behavior: 'smooth' });
    }
    document.querySelectorAll('nav button[data-view]').forEach(b => b.addEventListener('click', () => showSection(b.dataset.view)));
    document.getElementById('year').textContent = new Date().getFullYear();

    /* ---------- Initialize UI with stored data ---------- */
    function refreshHomeComplaints() {
      const cs = store.get('complaints') || [];
      const out = cs.slice(0, 4).map(c => `${c.complaintId} — ${c.category} — ${c.status}`).join('<br>');
      document.getElementById('home-complaints').innerHTML = out || '<span class="muted">No complaints yet.</span>';
    }
    function refreshGallery() {
      const cs = store.get('complaints') || [];
      const gallery = document.getElementById('gallery'); gallery.innerHTML = '';
      cs.slice(0, 9).forEach(c => {
        if (c.mediaType && c.mediaUrl) {
          const img = document.createElement(c.mediaType.startsWith('image') ? 'img' : 'video');
          img.src = c.mediaUrl; img.style.width = '100%'; img.style.height = '100px'; img.style.objectFit = 'cover'; img.style.borderRadius = '8px';
          gallery.appendChild(img);
        } else {
          const placeholder = document.createElement('div'); placeholder.className = 'small-card'; placeholder.textContent = c.category;
          gallery.appendChild(placeholder);
        }
      });
      if (!gallery.innerHTML) gallery.innerHTML = '<div class="muted small">No media available yet.</div>';
    }
    function refreshNGOList() {
      const list = store.get('ngos') || [];
      const el = document.getElementById('ngolist'); el.innerHTML = '';
      if (list.length === 0) el.innerHTML = '<div class="muted small">No NGOs registered yet.</div>';
      list.forEach(n => {
        const card = document.createElement('div'); card.className = 'leader-row';
        card.innerHTML = `<div><strong>${escapeHtml(n.name)}</strong><div class="small muted">${escapeHtml(n.mission || '—')}</div></div>
                      <div><a href="mailto:${escapeHtml(n.email)}" class="pill">Contact</a></div>`;
        el.appendChild(card);
      });
    }
    function refreshLeaderboard() {
      const vols = store.get('volunteers') || [];
      const lb = document.getElementById('leaderboard'); lb.innerHTML = '';
      const top = (vols.sort((a, b) => (b.points || 0) - (a.points || 0))).slice(0, 5);
      if (top.length === 0) lb.innerHTML = '<div class="muted small">No volunteers yet.</div>';
      top.forEach((v, i) => {
        const row = document.createElement('div'); row.className = 'leader-row';
        row.innerHTML = `<div>#${i + 1} <strong>${escapeHtml(v.name)}</strong></div><div>${v.points || 0} pts</div>`;
        lb.appendChild(row);
      });
    }

    /* ---------- helpers: safe html ---------- */
    function escapeHtml(s = '') { return String(s).replace(/[&<>"']/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[c]); }

    /* ---------- Complaint form handling ---------- */
    const cForm = document.getElementById('complaint-form');
    let lastCapturedLoc = null;
    captureLocation(); // attempt once
    cForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const cat = document.getElementById('c-category').value;
      const desc = document.getElementById('c-desc').value.trim();
      const mediaEl = document.getElementById('c-media');
      let mediaUrl = null, mediaType = null;
      if (mediaEl.files && mediaEl.files[0]) {
        // create local blob URL for demo persistence (not permanent) and also store as data URL
        const file = mediaEl.files[0];
        mediaType = file.type;
        mediaUrl = await fileToDataUrl(file);
      }
      const id = complaintId();
      const payload = { complaintId: id, category: cat, description: desc, mediaUrl, mediaType, location: lastCapturedLoc, status: 'Accepted', createdAt: new Date().toISOString() };
      store.push('complaints', payload);
      document.getElementById('complaint-msg').textContent = `Submitted — ID: ${id}`;
      document.getElementById('c-desc').value = ''; mediaEl.value = '';
      refreshHomeComplaints(); refreshGallery(); populateTrackRecent();
    });

    /* Location capture */
    function captureLocation() {
      const out = document.getElementById('c-loc'); out.value = 'Capturing…';
      if (!navigator.geolocation) { out.value = 'Geolocation not supported'; return; }
      navigator.geolocation.getCurrentPosition(pos => {
        lastCapturedLoc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
        out.value = `${lastCapturedLoc.lat.toFixed(6)}, ${lastCapturedLoc.lng.toFixed(6)}`;
      }, err => {
        out.value = 'Permission denied / not available';
      }, { enableHighAccuracy: true, timeout: 8000 });
    }

    /* file to data URL */
    function fileToDataUrl(file) {
      return new Promise((res, rej) => {
        const r = new FileReader(); r.onload = () => res(r.result); r.onerror = () => rej(); r.readAsDataURL(file);
      });
    }

    /* ---------- Track search ---------- */
    function searchComplaint() {
      const q = document.getElementById('track-id').value.trim();
      const results = (store.get('complaints') || []).filter(c => c.complaintId === q);
      const out = document.getElementById('track-result'); out.innerHTML = '';
      if (!q) { out.innerHTML = '<div class="muted small">Enter a valid Complaint ID.</div>'; return; }
      if (results.length === 0) { out.innerHTML = '<div class="muted small">No complaint found.</div>'; return; }
      const c = results[0];
      const el = document.createElement('div'); el.className = 'complaint-card';
      el.innerHTML = `<div style="flex:1">
    <div class="complaint-meta">ID: <strong>${c.complaintId}</strong></div>
    <div style="margin-top:6px"><strong>${escapeHtml(c.category)}</strong></div>
    <div class="muted" style="margin-top:6px">${escapeHtml(c.description)}</div>
    <div style="margin-top:8px">Status: <span style="font-weight:700">${escapeHtml(c.status)}</span></div>
    <div class="muted" style="margin-top:6px">Loc: ${c.location ? `${c.location.lat.toFixed(5)}, ${c.location.lng.toFixed(5)}` : 'Not provided'}</div>
    </div>
    <div style="width:140px">` + (c.mediaUrl ? `<img src="${c.mediaUrl}" style="width:100%;border-radius:8px" alt="media">` : '<div class="small muted">No media</div>') + `</div>`;
      out.appendChild(el);
    }

    /* helper: shows recent complaint list for track UI */
    function populateTrackRecent() {
      const cs = store.get('complaints') || [];
      const track = document.getElementById('track-result');
      // not overwriting immediate results; keep minimal
    }

    /* ---------- Auth / NGO registration (simple localStorage demo) ---------- */
    const authForm = document.getElementById('auth-form');
    const authMsg = document.getElementById('auth-msg');
    const authLoginBtn = document.getElementById('btn-auth-login');
    let currentUser = store.get('session') || null;
    updateAuthArea();

    authForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('auth-name').value.trim();
      const email = document.getElementById('auth-email').value.trim().toLowerCase();
      const phone = document.getElementById('auth-phone').value.trim();
      const pass = document.getElementById('auth-pass').value;
      if (pass.length < 6) { authMsg.textContent = 'Password must be at least 6 characters'; return; }
      const ngos = store.get('ngos') || [];
      // treat this registration as NGO or Volunteer depending on email domain or user intent (simple demo)
      const isNGO = email.includes('@ngo') || name.toLowerCase().includes('ngo');
      ngos.push({ name, email, phone, mission: 'Local mangrove work', isNGO, createdAt: new Date().toISOString() });
      store.set('ngos', ngos);
      // also create volunteer entry if not NGO
      if (!isNGO) {
        const vols = store.get('volunteers') || []; vols.push({ name, email, phone, points: 0 }); store.set('volunteers', vols);
      }
      // save credentials (insecure - demo only)
      const users = store.get('users') || {}; users[email] = { name, email, pass, isNGO }; store.set('users', users);
      authMsg.textContent = 'Registered! You may now login using the Login button.';
      refreshNGOList(); refreshLeaderboard();
      authForm.reset();
    });

    authLoginBtn.addEventListener('click', () => {
      const email = document.getElementById('auth-email').value.trim().toLowerCase();
      const pass = document.getElementById('auth-pass').value;
      const users = store.get('users') || {};
      if (!users[email] || users[email].pass !== pass) { authMsg.textContent = 'Invalid credentials'; return; }
      currentUser = { email, name: users[email].name, isNGO: users[email].isNGO };
      store.set('session', currentUser);
      authMsg.textContent = `Logged in as ${currentUser.name}`;
      updateAuthArea(); showNGODashboardIfNGO();
    });

    /* top right login button */
    document.getElementById('btn-login').addEventListener('click', () => {
      if (currentUser) { // logout
        store.set('session', null); currentUser = null; updateAuthArea(); document.getElementById('auth-msg').textContent = 'Logged out';
      } else {
        showSection('ngos'); // show registration/login area
      }
    });

    function updateAuthArea() {
      const area = document.getElementById('auth-area');
      area.innerHTML = '';
      if (currentUser) {
        const span = document.createElement('div'); span.style.display = 'flex'; span.style.gap = '8px'; span.style.alignItems = 'center';
        span.innerHTML = `<div class="pill">${escapeHtml(currentUser.name)}</div><button class="pill" id="logout-small">Logout</button>`;
        area.appendChild(span);
        document.getElementById('logout-small').addEventListener('click', () => { store.set('session', null); currentUser = null; updateAuthArea(); });
      } else {
        const b = document.createElement('button'); b.id = 'btn-login-small'; b.className = 'pill'; b.textContent = 'Login/Register'; b.addEventListener('click', () => showSection('ngos'));
        area.appendChild(b);
      }
    }

    /* NGO dashboard: view complaints and update statuses if logged in as NGO */
    function showNGODashboardIfNGO() {
      if (!currentUser || !currentUser.isNGO) return;
      const dash = document.getElementById('ngo-dashboard');
      const complaints = store.get('complaints') || [];
      if (complaints.length === 0) { dash.innerHTML = '<div class="muted small">No complaints</div>'; return; }
      const container = document.createElement('div'); container.style.display = 'grid'; container.style.gap = '8px';
      complaints.slice(0, 10).forEach(c => {
        const row = document.createElement('div'); row.className = 'leader-row';
        row.innerHTML = `<div><strong>${c.complaintId}</strong><div class="small muted">${c.category} • ${c.description}</div></div>
                     <div style="display:flex;flex-direction:column;gap:6px">
                       <div class="small muted">${c.status}</div>
                       <div style="display:flex;gap:6px">
                         <button class="pill" onclick="updateComplaintStatus('${c.complaintId}','Accepted')">Accept</button>
                         <button class="pill" onclick="updateComplaintStatus('${c.complaintId}','Taking Action')">Action</button>
                         <button class="pill" onclick="updateComplaintStatus('${c.complaintId}','Solved')">Solved</button>
                       </div>
                     </div>`;
        container.appendChild(row);
      });
      dash.innerHTML = ''; dash.appendChild(container);
    }
    function showNGODashboardIfNGO_wrapper() { showNGODashboardIfNGO(); refreshHomeComplaints(); refreshGallery(); }
    function showNGODashboardIfNGO_onload() { if (store.get('session')) currentUser = store.get('session'); updateAuthArea(); showNGODashboardIfNGO_wrapper(); }
    window.addEventListener('load', showNGODashboardIfNGO_onload);

    function updateComplaintStatus(cid, status) {
      const complaints = store.get('complaints') || [];
      const idx = complaints.findIndex(c => c.complaintId === cid);
      if (idx >= 0) { complaints[idx].status = status; store.set('complaints', complaints); showNGODashboardIfNGO_wrapper(); alert('Status updated'); }
    }

    /* ---------- Donations (demo) ---------- */
    let donateAmount = 500;
    function setDonate(a) { donateAmount = a; document.getElementById('don-custom').value = ''; alert('Amount set to ₹' + a); }
    function doDonate() {
      const custom = document.getElementById('don-custom').value.trim();
      const amt = custom ? Number(custom) : donateAmount;
      if (!amt || amt <= 0) { alert('Enter valid amount'); return; }
      // store donation record
      store.push('donations', { amount: amt, date: new Date().toISOString(), user: currentUser ? currentUser.email : 'anonymous' });
      alert('Thank you! Demo donation recorded: ₹' + amt);
    }

    /* ---------- Contact form ---------- */
    document.getElementById('contact-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('ct-name').value.trim();
      const email = document.getElementById('ct-email').value.trim();
      const msg = document.getElementById('ct-msg').value.trim();
      store.push('contacts', { name, email, msg, createdAt: new Date().toISOString() });
      document.getElementById('contact-res').textContent = 'Message sent — we will contact you soon.';
      e.target.reset();
    });

    /* ---------- Utilities & init ---------- */
    function initDemo() {
      refreshHomeComplaints(); refreshGallery(); refreshNGOList(); refreshLeaderboard();
      // initial view: home
      showSection('home');
    }
    initDemo();

    /* small utility to allow NGO update buttons access from string context */
    window.updateComplaintStatus = updateComplaintStatus;
    window.showSection = showSection;
    window.captureLocation = captureLocation;
    window.fileToDataUrl = fileToDataUrl;
    window.searchComplaint = searchComplaint;

    /* escape hook for page load of stored session */
    if (store.get('session')) { currentUser = store.get('session'); updateAuthArea(); showNGODashboardIfNGO_wrapper(); }

  </script>
</body>

</html>